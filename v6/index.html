<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>4 Chronos pour Pot à Mèche</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#ffffff">

  <!-- Icône -->
  <link rel="icon" href="./icon_4_chrono_2.png">

  <!-- Style V4 conservé -->
  <link rel="stylesheet" href="./style.css">
</head>

<body>

<!-- ==========================
     HEADER
========================== -->
<header class="topbar">
  <div class="top-left">
    <img src="./icon_4_chrono_2.png" class="top-logo" alt="logo">
    <button id="btnHelp" class="btn-help">Aide</button>
  </div>

  <div class="top-title">Pot à Mèche</div>

  <div class="top-right">
    <div>B. Barrois</div>
    <div id="version">version</div>
  </div>
</header>

<!-- ==========================
     ACTIONS
========================== -->
<div class="top-actions">
  <button id="btnCapt" class="btn-capt">Capture d’écran</button>
  <div id="dateTime"></div>
  <button id="btnLoc" class="btn-loc">Localisation du nid</button>
</div>

<!-- ==========================
     CHRONOS
========================== -->
<main id="chronos">
  <!-- Généré par ui.js -->
</main>

<!-- ==========================
     VERSION
========================== -->
<script src="./version.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    if (typeof APP_VERSION !== "undefined") {
      document.getElementById("version").textContent =
        "v. : " + APP_VERSION;
    }
  });
</script>

<!-- ==========================
     DATE & HEURE
========================== -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const el = document.getElementById("dateTime");
    if (!el) return;

    function update() {
      const n = new Date();
      el.textContent =
        n.toLocaleDateString("fr-FR") + " " +
        n.toLocaleTimeString("fr-FR", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit"
        });
    }

    update();
    setInterval(update, 1000);
  });
</script>

<!-- ==========================
     CAPTURE D'ÉCRAN
========================== -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  document.getElementById("btnCapt").onclick = async () => {
    const canvas = await html2canvas(document.body, { scale: 2 });
    const blob = await new Promise(r => canvas.toBlob(r,"image/png"));

    const name =
      "Chrono_Frelon_" +
      new Date().toISOString().replace(/[:.]/g,"-") +
      ".png";

    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = name;
    a.click();
  };
</script>

<!-- ==========================
     AIDE (UI seule)
========================== -->
<script>
document.getElementById("btnHelp").onclick = () => {
  const o = document.createElement("div");
  o.id = "helpOverlay";
  o.innerHTML = `
    <div class="help-box">
      <h2>Aide – Pot à Mèche</h2>
      <ul>
        <li>Chaque couleur = une station</li>
        <li>Start / Stop : mesure du temps</li>
        <li>Position : GPS</li>
        <li>Boussole : direction</li>
        <li>Détail : nettoyage des valeurs</li>
      </ul>
      <button onclick="this.closest('#helpOverlay').remove()">Fermer</button>
    </div>
  `;
  document.body.appendChild(o);
};
</script>

<!-- ==========================
     APP V6 (MODULE)
========================== -->
<script type="module" src="./app.js"></script>



</body>
</html>
