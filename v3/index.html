<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Chronos v3</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#ffffff">

  <!-- Icône -->
  <link rel="icon" href="./icon_4_chrono_2.png">

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css">

  <!-- Version -->
  <script src="./version.js"></script>
</head>

<body>

  <!-- HEADER -->
  <header class="topbar">
    <img src="./icon_4_chrono_2.png" class="top-logo" alt="logo">

    <div class="top-title">
      Chronos <span style="font-size:0.6em;color:#888">(v3)</span>
    </div>

    <div class="top-right">
      <div>B.BARROIS</div>
      <div id="version">version </div>
    </div>
  </header>
  <div class="top-actions">
    <button id="btnCapt" class="btn-capt">Capture d’écran</button>
    <button id="btnLoc" class="btn-loc">Localisation du nid</button>
  </div>


  <!-- CONTENEUR DES CHRONOS -->
  <main id="chronos">
    <!-- Les chronos seront générés par app.js -->
  </main>

  <!-- SCRIPT PRINCIPAL -->
  <script src="./app.js"></script>

  <!-- AFFICHAGE VERSION -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const v = document.getElementById("version");
      if (v && typeof APP_VERSION !== "undefined") {
        v.textContent = "v. : " + APP_VERSION;
      }
    });
  </script>

  <!-- SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  
  <script>
  document.getElementById("btnCapt").addEventListener("click", async () => {
    const canvas = await html2canvas(document.body, {
      scale: 2,
      useCORS: true
    });
  
    const blob = await new Promise(resolve =>
      canvas.toBlob(resolve, "image/png")
    );
  
    const filename =
      "Chrono_Frelon_" +
      new Date().toISOString().replace(/[:.]/g, "-") +
      ".png";
  
    if (navigator.share) {
      try {
        const file = new File([blob], filename, { type: "image/png" });
        await navigator.share({
          files: [file],
          title: "Chrono Frelon",
          text: "Capture d’écran"
        });
        return;
      } catch (e) {}
    }
  
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
  });
  </script>

</body>
</html>
